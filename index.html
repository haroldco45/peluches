<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibras Positivas - Negocio de Marle</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --pink: #ff69b4; --green: #25d366; --bg: #fff5f8; --admin: #5d6d7e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .app-container { max-width: 500px; margin: auto; background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #ffe1ed; }
        .header { background: var(--pink); color: white; padding: 15px; text-align: center; }
        .section { padding: 15px; border-bottom: 1px solid #eee; }
        h3 { margin: 0 0 10px 0; color: var(--pink); font-size: 1.1em; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 8px; width: 100%; box-sizing: border-box; }
        .products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .product-card { background: #fff; border: 1px solid #ffe1ed; border-radius: 15px; padding: 10px; text-align: center; position: relative; }
        .product-card img { width: 100%; height: 120px; object-fit: contain; border-radius: 10px; }
        .product-name { font-size: 0.85em; font-weight: bold; display: block; margin: 8px 0; height: 35px; overflow: hidden; }
        .qty-input { width: 70px !important; text-align: center; border: 2px solid #ffe1ed; border-radius: 8px; padding: 5px; font-weight: bold; }
        
        /* Ocultar elementos de admin por defecto */
        .admin-controls { display: none; margin-bottom: 10px; background: #eee; padding: 10px; border-radius: 10px; }
        .btn-toggle { position: absolute; top: 5px; right: 5px; background: white; border: 1px solid #ddd; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; display: none; }
        .hidden-item { display: none; }
        
        /* Modo edici√≥n activado */
        .edit-mode .admin-controls { display: block; }
        .edit-mode .btn-toggle { display: flex; align-items: center; justify-content: center; }
        .edit-mode .hidden-item { display: block; opacity: 0.4; filter: grayscale(1); }

        .resumen-box { background: #fffef0; padding: 10px; border-radius: 10px; border: 1px solid #f1c40f; margin-top: 10px; font-size: 0.9em; }
        .actions { padding: 15px; display: grid; gap: 10px; }
        button { padding: 14px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-wa { background: var(--green); }
        .btn-xl { background: #1d6f42; }
        .btn-admin-access { background: none; color: #ccc; font-size: 0.7em; padding: 5px; margin-top: 20px; }
    </style>
</head>
<body id="bodyApp">

<div class="app-container">
    <div class="header">
        <h2 style="margin:0">‚ú® Vibras Positivas ‚ú®</h2>
        <div style="font-size:0.8em">Negocio de Marle</div>
    </div>

    <div class="section">
        <h3>üë§ Tus Datos de Env√≠o</h3>
        <input type="text" id="cNombre" placeholder="Tu Nombre">
        <input type="text" id="cDireccion" placeholder="Direcci√≥n y Barrio">
        <input type="tel" id="cCelular" placeholder="Tu Celular">
    </div>

    <div class="section">
        <div class="admin-controls">
            <strong>Panel Admin:</strong>
            <button style="background:#3498db; padding:8px; font-size:0.8em" onclick="document.getElementById('fIn').click()">Subir Nueva Foto</button>
            <input type="file" id="fIn" style="display:none" accept="image/*" onchange="subirFotoLocal(event)">
        </div>
        <h3>üß∏ Elige tus Productos</h3>
        <div class="products-grid" id="catalog"></div>
    </div>

    <div class="section">
        <h3>üìù Resumen de Pedido</h3>
        <div id="lista-resumen" class="resumen-box">No has elegido nada a√∫n.</div>
    </div>

    <div class="actions">
        <button class="btn-wa" onclick="enviarWhatsApp()">üü¢ Pedir por WhatsApp</button>
        <button class="btn-xl" onclick="exportarExcel()">üìä Descargar Factura (Excel)</button>
        <button class="btn-admin-access" onclick="activarAdmin()">‚öôÔ∏è</button>
    </div>
</div>

<script>
    const archivos = [
        "CAPIBARA CERDITO.jpg", "CAPIBARA TIBURON.jpg", "DINOSAURIO AZUL.jpg",
        "POKEMON FUEGO.jpg", "POKEMON PSYDUCK.jpg", "TORO GRIS.jpg",
        "CONEJITOMORADO.JPG", "GATO NEGRO.JPG", "PERRITO.JPG", "UNICORNIO CELESTE.png"
    ];

    let desactivados = JSON.parse(localStorage.getItem('marle_desactivados')) || [];
    let catalogoExtra = JSON.parse(localStorage.getItem('marle_extra')) || [];

    function mostrar() {
        const c = document.getElementById('catalog');
        c.innerHTML = "";
        archivos.forEach((n, i) => crearCard(c, `fotos/${n}`, n.split('.')[0], `f_${i}`, n));
        catalogoExtra.forEach((p, i) => crearCard(c, p.img, p.nombre, `e_${i}`, p.nombre));
        actualizarResumen();
    }

    function crearCard(contenedor, src, nombre, id, ref) {
        const isHidden = desactivados.includes(ref);
        contenedor.innerHTML += `
            <div class="product-card ${isHidden ? 'hidden-item' : ''}">
                <button class="btn-toggle" onclick="toggleItem('${ref}')">${isHidden ? '‚ùå' : 'üëÅÔ∏è'}</button>
                <img src="${src}" alt="${nombre}" onerror="this.src='https://via.placeholder.com/150?text=Peluche'">
                <span class="product-name">${nombre}</span>
                <input type="number" class="qty-input" id="q_${id}" value="0" min="0" oninput="actualizarResumen()">
            </div>`;
    }

    function activarAdmin() {
        document.getElementById('bodyApp').classList.toggle('edit-mode');
        alert("Modo Administrador: Ahora puedes ocultar/activar fotos con el ojo o subir nuevas.");
    }

    function toggleItem(n) {
        desactivados.includes(n) ? desactivados = desactivados.filter(x => x!==n) : desactivados.push(n);
        localStorage.setItem('marle_desactivados', JSON.stringify(desactivados));
        mostrar();
    }

    function subirFotoLocal(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const nom = prompt("Nombre del peluche:");
            if(nom) {
                catalogoExtra.push({nombre: nom, img: ev.target.result});
                localStorage.setItem('marle_extra', JSON.stringify(catalogoExtra));
                mostrar();
            }
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    function actualizarResumen() {
        const res = document.getElementById('lista-resumen');
        let html = "";
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) {
                html += `<div>‚Ä¢ ${input.previousElementSibling.innerText}: <b>${input.value}</b></div>`;
            }
        });
        res.innerHTML = html || "No has elegido nada a√∫n.";
    }

    function enviarWhatsApp() {
        const cli = document.getElementById('cNombre').value;
        const dir = document.getElementById('cDireccion').value;
        const cel = document.getElementById('cCelular').value;
        let txt = `*‚ú® VIBRAS POSITIVAS - NEGOCIO DE MARLE ‚ú®*%0A*Cliente:* ${cli}%0A*Direcci√≥n:* ${dir}%0A*Celular:* ${cel}%0A------------------%0A`;
        let hay = false;
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) {
                txt += `‚Ä¢ ${input.previousElementSibling.innerText} (x${input.value})%0A`;
                hay = true;
            }
        });
        if(!cli || !hay) return alert("Por favor escribe tu nombre y elige alg√∫n peluche.");
        window.open(`https://wa.me/3117700431?text=${txt}`, '_blank');
    }

    function exportarExcel() {
        let datos = [["VIBRAS POSITIVAS - NEGOCIO DE MARLE"], ["Cliente", document.getElementById('cNombre').value], ["Direcci√≥n", document.getElementById('cDireccion').value], [], ["Producto", "Cantidad"]];
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) datos.push([input.previousElementSibling.innerText, input.value]);
        });
        if(datos.length < 6) return alert("El pedido est√° vac√≠o.");
        const ws = XLSX.utils.aoa_to_sheet(datos);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Pedido");
        XLSX.writeFile(wb, "Factura_Marle.xlsx");
    }

    window.onload = mostrar;
</script>
</body>
</html>
