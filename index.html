<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibras Positivas - Negocio de Marle</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --pink: #ff69b4; --green: #25d366; --bg: #fff5f8; --admin: #5d6d7e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .app-container { max-width: 500px; margin: auto; background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid #ffe1ed; }
        .header { background: var(--pink); color: white; padding: 15px; text-align: center; }
        #live-clock { font-size: 0.85em; margin-top: 5px; font-weight: 300; }
        .section { padding: 15px; border-bottom: 1px solid #eee; }
        h3 { margin: 0 0 10px 0; color: var(--pink); font-size: 1.1em; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 8px; width: 100%; box-sizing: border-box; }
        .products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .product-card { background: #fff; border: 1px solid #ffe1ed; border-radius: 15px; padding: 10px; text-align: center; position: relative; }
        .product-card img { width: 100%; height: 120px; object-fit: contain; border-radius: 10px; }
        .product-name { font-size: 0.85em; font-weight: bold; display: block; margin: 8px 0; height: 35px; overflow: hidden; }
        .price-display { color: var(--green); font-weight: bold; font-size: 0.9em; margin-bottom: 5px; display: block; }
        .qty-input { width: 70px !important; text-align: center; border: 2px solid #ffe1ed; border-radius: 8px; padding: 5px; font-weight: bold; }
        .admin-controls { display: none; background: #eee; padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .btn-toggle { position: absolute; top: 5px; right: 5px; background: white; border: 1px solid #ddd; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; display: none; z-index: 10; }
        .edit-mode .admin-controls { display: block; }
        .edit-mode .btn-toggle { display: flex; align-items: center; justify-content: center; }
        .hidden-item { display: none; }
        .edit-mode .hidden-item { display: block; opacity: 0.4; filter: grayscale(1); }
        .resumen-box { background: #fffef0; padding: 10px; border-radius: 10px; border: 1px solid #f1c40f; margin-top: 10px; font-size: 0.9em; }
        .actions { padding: 15px; display: grid; gap: 10px; }
        button { padding: 14px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-wa { background: var(--green); }
        .btn-xl { background: #1d6f42; }
        .btn-admin-access { background: none; color: #ddd; font-size: 0.7em; padding: 5px; margin-top: 20px; border: none; }
    </style>
</head>
<body id="bodyApp">
<div class="app-container">
    <div class="header">
        <h2 style="margin:0">‚ú® Vibras Positivas ‚ú®</h2>
        <div id="live-clock">Cargando hora de Colombia...</div>
    </div>
    <div class="section">
        <h3>üë§ Tus Datos de Env√≠o</h3>
        <input type="text" id="cNombre" placeholder="Tu Nombre Completo">
        <input type="text" id="cDireccion" placeholder="Direcci√≥n de Env√≠o y Ciudad">
        <input type="tel" id="cCelular" placeholder="Tu Celular de contacto">
    </div>
    <div class="section">
        <div class="admin-controls">
            <strong>üîí Panel Marle:</strong>
            <button style="background:#3498db; padding:8px; font-size:0.8em; margin-top:5px" onclick="document.getElementById('fIn').click()">Subir Nueva Foto</button>
            <input type="file" id="fIn" style="display:none" accept="image/*" onchange="subirFotoLocal(event)">
        </div>
        <h3>üß∏ Elige tus Productos</h3>
        <div class="products-grid" id="catalog"></div>
    </div>
    <div class="section">
        <h3>üìù Resumen de Pedido</h3>
        <div id="lista-resumen" class="resumen-box">No has elegido nada a√∫n.</div>
    </div>
    <div class="actions">
        <button class="btn-wa" onclick="enviarWhatsApp()">üü¢ Pedir por WhatsApp</button>
        <button class="btn-xl" onclick="exportarExcel()">üìä Descargar Excel</button>
        <button class="btn-admin-access" onclick="accesoSeguro()">‚öôÔ∏è</button>
    </div>
</div>
<script>
    const archivos = [
        {n: "CAPIBARA CERDITO.jpg", p: 110000}, {n: "CAPIBARA TIBURON.jpg", p: 110000},
        {n: "DINOSAURIO AZUL.jpg", p: 95000}, {n: "POKEMON FUEGO.jpg", p: 85000},
        {n: "POKEMON PSYDUCK.jpg", p: 85000}, {n: "TORO GRIS.jpg", p: 90000},
        {n: "CONEJITOMORADO.JPG", p: 80000}, {n: "GATO NEGRO.JPG", p: 85000},
        {n: "PERRITO.JPG", p: 80000}, {n: "UNICORNIO CELESTE.png", p: 95000}
    ];

    let desactivados = JSON.parse(localStorage.getItem('marle_desactivados')) || [];
    let catalogoExtra = JSON.parse(localStorage.getItem('marle_extra')) || [];

    function updateClock() {
        const now = new Date();
        const opt = { timeZone: 'America/Bogota', hour12: true, hour: '2-digit', minute: '2-digit', second: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric' };
        document.getElementById('live-clock').innerHTML = "üá®üá¥ " + now.toLocaleString('es-CO', opt);
    }
    setInterval(updateClock, 1000);

    function mostrar() {
        const c = document.getElementById('catalog');
        c.innerHTML = "";
        archivos.forEach((p, i) => crearCard(c, `fotos/${p.n}`, p.n.split('.')[0], `f_${i}`, p.n, p.p));
        catalogoExtra.forEach((p, i) => crearCard(c, p.img, p.nombre, `e_${i}`, p.nombre, p.precio || 85000));
        actualizarResumen();
    }

    function crearCard(contenedor, src, nombre, id, ref, precio) {
        const isHidden = desactivados.includes(ref);
        contenedor.innerHTML += `
            <div class="product-card ${isHidden ? 'hidden-item' : ''}">
                <button class="btn-toggle" onclick="toggleItem('${ref}')">${isHidden ? '‚ùå' : 'üëÅÔ∏è'}</button>
                <img src="${src}" alt="${nombre}" onerror="this.src='https://via.placeholder.com/150?text=Peluche'">
                <span class="product-name">${nombre}</span>
                <span class="price-display">$${precio.toLocaleString()}</span>
                <input type="number" class="qty-input" id="q_${id}" data-precio="${precio}" value="0" min="0" oninput="actualizarResumen()">
            </div>`;
    }

    function accesoSeguro() {
        const pass = prompt("Ingrese la contrase√±a de administrador:");
        if(pass === "Marle2026") {
            document.getElementById('bodyApp').classList.toggle('edit-mode');
            alert("Modo Administrador activado.");
        } else {
            alert("Contrase√±a incorrecta.");
        }
    }

    function toggleItem(n) {
        desactivados.includes(n) ? desactivados = desactivados.filter(x => x!==n) : desactivados.push(n);
        localStorage.setItem('marle_desactivados', JSON.stringify(desactivados));
        mostrar();
    }

    function subirFotoLocal(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const nom = prompt("Nombre del peluche:");
            const pre = prompt("Precio del peluche:", "85000");
            if(nom) {
                catalogoExtra.push({nombre: nom, img: ev.target.result, precio: parseInt(pre)});
                localStorage.setItem('marle_extra', JSON.stringify(catalogoExtra));
                mostrar();
            }
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    function actualizarResumen() {
        const res = document.getElementById('lista-resumen');
        let html = ""; let total = 0;
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) {
                const sub = input.value * input.dataset.precio;
                html += `<div>‚Ä¢ ${input.parentElement.querySelector('.product-name').innerText}: ${input.value} x $${parseInt(input.dataset.precio).toLocaleString()} = <b>$${sub.toLocaleString()}</b></div>`;
                total += sub;
            }
        });
        res.innerHTML = html ? html + `<hr><b>TOTAL: $${total.toLocaleString()}</b>` : "No has elegido nada a√∫n.";
    }

    function enviarWhatsApp() {
        const cli = document.getElementById('cNombre').value;
        const dir = document.getElementById('cDireccion').value;
        const time = document.getElementById('live-clock').innerText;
        let txt = `*‚ú® VIBRAS POSITIVAS - NEGOCIO DE MARLE ‚ú®*%0A*Fecha:* ${time}%0A*Cliente:* ${cli}%0A*Direcci√≥n:* ${dir}%0A------------------%0A`;
        let total = 0; let hay = false;
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) {
                const sub = input.value * input.dataset.precio;
                txt += `‚Ä¢ ${input.parentElement.querySelector('.product-name').innerText} (x${input.value}) - $${sub.toLocaleString()}%0A`;
                total += sub; hay = true;
            }
        });
        if(!cli || !hay) return alert("Faltan datos.");
        txt += `------------------%0A*TOTAL A PAGAR: $${total.toLocaleString()}*`;
        window.open(`https://wa.me/3117700431?text=${txt}`, '_blank');
    }

    function exportarExcel() {
        const cli = document.getElementById('cNombre').value;
        const time = document.getElementById('live-clock').innerText;
        let datos = [
            ["VIBRAS POSITIVAS - NEGOCIO DE MARLE"],
            ["Fecha:", time],
            ["Cliente:", cli],
            ["Direcci√≥n:", document.getElementById('cDireccion').value],
            [],
            ["Producto", "Cantidad", "Precio Unit.", "Subtotal"]
        ];
        let total = 0;
        document.querySelectorAll('.qty-input').forEach(input => {
            if(input.value > 0) {
                const sub = input.value * input.dataset.precio;
                datos.push([input.parentElement.querySelector('.product-name').innerText, input.value, parseInt(input.dataset.precio), sub]);
                total += sub;
            }
        });
        datos.push([], ["", "", "TOTAL GENERAL:", total]);
        const ws = XLSX.utils.aoa_to_sheet(datos);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Factura");
        XLSX.writeFile(wb, `Factura_${cli}.xlsx`);
    }
    window.onload = () => { updateClock(); mostrar(); };
</script>
</body>
</html>
